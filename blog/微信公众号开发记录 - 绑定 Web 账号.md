绑定微信公众号，是 Web 开发的常见需求，本文记录我在开发过程中遇到的问题。



公众号申请地址：https://mp.weixin.qq.com/



按照提示进行操作即可，公众号分为两种：

- 订阅号
- 服务号



两者的开发逻辑和流程基本一致，区别在于部分接口的能力不同，根据需要选择即可。



注册完登录进去后，微信提供了测试账号，方便我们在公众号认证通过之前，即可投入开发。



<img src="C:\Users\shiweifu\AppData\Roaming\Typora\typora-user-images\image-20221102000306624.png" alt="image-20221102000306624" style="zoom:50%;" />



使用之前，需要首先绑定服务器。被绑定的服务器，有以下要求：



- 部署到公网服务器
  - 在开发环境，可以通过代理来实现，我使用的是 [蜻蜓映射](https://cloud.51miaole.com/)，需要在本地装个客户端，简单配置一下内网服务器的地址即可使用。
- 任意语言搭建的 Web 开发环境
- 可以响应 `get` 请求，按照微信要求的方式，进行加密并返回



进行绑定时，微信会向所填写绑定的地址，发送请求，并验证返回信息，验证通过后，即可完成绑定。官方文档给出了一个完整的使用 Python 开发的示例，可以参考。



[接入概述 | 微信开放文档 (qq.com)](https://developers.weixin.qq.com/doc/offiaccount/Basic_Information/Access_Overview.html)



如果是其他语言，可以搜索一下，基本都能找到加密部分的代码。

详情页下方，列出了该公众号可调用的接口。我们所需要用到的接口，在开发阶段都可以正常使用。



绑定完我们的服务器之后，就可以开始开发啦。我们首先来实现账号绑定，整个流程应该是：



- 确保可以接收用户关注公众号的消息
  - 用户关注的消息中，会带有 openid，这个 openid，同一个用户，对同一个公众号，是唯一的
  - 根据这个 openid，生成URL，返回给用户
    - 这里最好不要直接带着把明文 openid 返回给用户，可以做一些加密，相应的，用户打开绑定链接时，也不要直接传递明文openid，可以考虑放在 session 什么的，做一些加密

- 用户点击带有 openid 信息的链接，进行绑定

  - 我是放在了登录界面，要求用户输入用户名、密码，提交时以约定的形式带上openid

  



